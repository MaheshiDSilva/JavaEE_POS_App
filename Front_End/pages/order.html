<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Purchase Order Manage</title>
    <meta content="width=device-width initial-scale=1" name="viewport">
<!--    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">-->
    <link href="../assets/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link crossorigin="anonymous" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
          integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" rel="stylesheet">
    <style>
        ul > li {
            cursor: pointer;
        }
    </style>



</head>
<body>
<!--header-->
<header class="jumbotron bg-primary text-white p-3">
    <h1 class="position-absolute" id="nav"></h1>
    <ul class="list-group list-group-horizontal text-danger justify-content-end font-weight-bold">
        <li class="list-group-item bg-white" id="lnkHome"><a href="../index.html">Home</a></li>
        <li class="list-group-item bg-white" id="lnkCustomer"><a href="customer.html">Customer</a></li>
        <li class="list-group-item bg-white" id="lnkItem"><a  href="item.html">Item</a></li>
        <li class="list-group-item bg-danger text-white" id="lnkOrders"><a class="text-white" href="order.html">Orders</a></li>
    </ul>
</header>

<!--order form-->
<main class="container-fluid" id="orderContent">
    <div class="container-fluid mt-4">
        <!--main tile-->
        <div class="jumbotron pt-4">
            <div class="row">
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header bg-primary font-weight-bolder">Invoice Details</div>
                        <div class="card-body">
                            <form id="invoiceDetails">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label>Order ID :</label>
                                            <input class="form-control" id="txtOrderID" type="text" name="orderId">
                                            <span class="control-error"
                                                  id="orderId-invalid-error"></span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label>Date :</label>
                                            <input class="form-control" id="txtDate" type="date" name="date">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label>Customer Id :</label>
                                            <select class="form-control" id="cmbCustomers" name="customerId">
<!--                                                <option value="1">A</option>-->
<!--                                                <option value="2">B</option>-->
                                            </select>
                                            <span class="control-error"
                                                  id="cus-empty-error"></span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label for="orderCustomerName">Customer Name</label>
                                            <input class="form-control" id="orderCustomerName" name="customerName">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <!--<div class="col-6">
                                        <div class="form-group">
                                            <label>Name :</label>
                                            <input class="form-control" id="orderCustomerName" type="text" name="cusName">
                                        </div>
                                    </div>-->
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label>Address :</label>
                                            <input class="form-control" id="orderCustomerAddress" type="text" name="address">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label>Salary :</label>
                                            <input class="form-control" id="orderCustomerSalary" type="text" name="salary">
                                        </div>
                                    </div>

                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5 mt-lg-0 mt-3">
                    <div class="card">
                        <div class="card-header bg-primary  font-weight-bolder">Item Select</div>
                        <div class="card-body">
                            <form id="itemSelect">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label>Item Code:</label>
                                            <select class="form-control" id="cmbItems" name="itemCode"></select>
                                            <span class="control-error"
                                                  id="item-empty-error"></span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label>Item Name :</label>
                                            <input class="form-control" id="txtItemName" type="text" name="itemName">
                                        </div>
                                    </div>
                                    <!--<div class="col-5">
                                        <div class="form-group">
                                            <label>Item Name :</label>
                                            <input class="form-control" id="txtItemDescription" type="text" name="itemName">
                                        </div>
                                    </div>-->
                                    <div class="col-3">
                                        <div class="form-group">
                                            <label class="">QtyOnH :</label>
                                            <input class="form-control" id="txtQTYOnHand" type="text" name="qtyOnHand">
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="form-group">
                                            <label class="">Price :</label>
                                            <input class="form-control" id="txtItemPrice" type="text" name="price">
                                        </div>
                                    </div>
                                    <hr>
                                    <hr>
                                    <div class="col-12 mt-4">
                                        <div class="form-group">
                                            <label>Order Quantity :</label>
                                            <input class="form-control" id="txtQty" min="1" type="number" name="orderQty">
                                            <span class="control-error" id="order-qty-empty-error"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group text-right">
                                    <button class="btn btn-danger col-12 col-sm-auto" id="btnAddToTable" type="button">
                                        Add Item
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <section class="content-box-2 p-4 ">
                        <div class="row">
                            <div class="col-12">
                                <div class="row">
                                    <div class="col-12">
                                        <span class="" id="total" name="total">Total : </span>
                                    </div>
                                    <div class="col-12">
                                        <span id="total2">00.0</span> Rs/=
                                    </div>
                                </div>

                            </div>
                            <div class="col-12">
                                <div class="row">
                                    <div class="col-12">
                                        <span id="total1">SubTotal : </span>
                                    </div>
                                    <div class="col-12">
                                        <span id="subtotal">00.0</span> Rs/=
                                    </div>
                                </div>

                            </div>
                            <div class="col-6 mt-2">
                                <div class="form-group">
                                    <label>Cash</label>
                                    <input class="form-control" id="txtCash" min="0" type="number" name="cash">
                                    <span class="control-error"
                                          id="cash-empty-error"></span>
                                </div>
                            </div>
                            <div class="col-6 mt-2">
                                <div class="form-group">
                                    <label>Discount</label>
                                    <input class="form-control" id="txtDiscount" min="0" type="number" name="discount">
                                </div>
                            </div>
                            <div class="col-8">
                                <div class="form-group">
                                    <label>Balance</label>
                                    <input class="form-control" id="txtBalance" type="text" name="balance">
                                </div>
                            </div>
                            <div class="col-4 mt-4">
                                <button class="btn btn-success" id="btnSubmitOrder" type="button">Purchase</button>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <!--order table-->
            <div class="col-md-12 mt-4" style="height:180px; overflow-y: scroll">
                <table class="table table-bordered text-white">
                    <thead class="bg-primary">
                    <tr>
                        <th>Item Code</th>
                        <th>Item Name</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Total</th>
                    </tr>
                    </thead>
                    <tbody class="bg-light text-dark" id="orderTable">

                    </tbody>
                </table>
            </div>
            <!---------->
        </div>
    </div>
</main>
<!--<main id="purchase-order"
       class="overflow-x overflow-auto d-flex flex-column align-items-center justify-content-evenly w-100 h-100">
    <div class="w-100">
        <form class="row g-3">
            <div class="col-md-3">
                <label for="cmbCustomerId" class="form-label">Customer ID</label>
                <select id="cmbCustomerId" class="form-select" name="customerId">

                </select>
            </div>
            <div class="col-md-3">
                <label for="cusName" class="form-label">Name</label>
                <input type="text" class="form-control" id="cusName" placeholder="Customer Name" name="customerName">
            </div>
            <div class="col-md-3">
                <label for="cusAddress" class="form-label">Address</label>
                <input type="text" class="form-control" id="cusAddress" placeholder="Address" name="customerAddress">
            </div>
            <div class="col-md-3">
                <label for="cusSalary" class="form-label">Salary</label>
                <input type="text" class="form-control" id="cusSalary" placeholder="Salary" name="salary">
            </div>
            <div class="col-md-3">
                <label for="cmbItemCode" class="form-label">Item Code</label>
                <select id="cmbItemCode" class="form-select" name="itemCode">

                </select>
            </div>
            <div class="col-md-3">
                <label for="item_name" class="form-label">Item Name</label>
                <input type="text" class="form-control" id="item_name" placeholder="Name" name="itemName">
            </div>
            <div class="col-md-3">
                <label for="qty_OnHand" class="form-label">QTY On Hand</label>
                <input type="number" class="form-control" id="qty_OnHand" placeholder="Qty On Hand" name="QtyOnHand">
            </div>
            <div class="col-md-3">
                <label for="unitPrice" class="form-label">Price</label>
                <input type="number" class="form-control" id="unitPrice" placeholder="Price" name="price">
            </div>
            <div class="d-flex justify-content-end col-12">
                <div class="col-lg-2 d-flex flex-column justify-content-end">
                    <div class="mb-2">
                        <label for="txtQty" class="form-label">Quantity</label>
                        <input type="number" class="form-control" id="txtQty" placeholder="Quantity" name="qty">
                    </div>
                    <button type="button" class="btn btn-warning mb-3" id="btnAddToCart">Add To Cart </button>
                </div>
            </div>
        </form>
    </div>

    &lt;!&ndash; Table &ndash;&gt;
    <div class="d-flex overflow-auto h-25 col-lg-8 col-12">
        <table class="table table-striped table-hover" id="tblCart">
            <thead class="table-dark sticky-top">
            <tr>
                <th scope="col">Item Code</th>
                <th scope="col">Item Name</th>
                <th scope="col">Unit Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Total</th>
                <th scope="col">Options</th>
            </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-end align-items-center w-100">
        <div class="mb-2 d-flex flex-column">
            <label for="total" class="form-label disabled mt-2">Total</label>
            <label id="total" name="total">Total</label>
        </div>

        &lt;!&ndash; Place Order Button &ndash;&gt;
        <div>
            <button type="button" class="btn btn-success mb-2" data-bs-toggle="modal"
                    data-bs-target="#modelPlaceOrder" id="btnPlaceOrder">
                Place Order</button>
        </div>

        &lt;!&ndash; Modal &ndash;&gt;
        <div class="modal fade" id="modelPlaceOrder" data-bs-backdrop="static" data-bs-keyboard="false"
             tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="static_BackdropLabel">Place Order</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                    </div>

                    &lt;!&ndash; Form &ndash;&gt;
                    <div class="row justify-content-center">
                        <form class="w-75" id="placeOrder">
                            <div class="mb-3">
                                <label for="orderId" class="form-label">Order ID</label>
                                <input type="text" class="form-control" id="orderId">
                            </div>
                            <div class="mb-3">
                                <label for="customerId" class="form-label">Customer ID</label>
                                <input type="text" class="form-control" id="customerId">
                            </div>
                            <div class="mb-3">
                                <label for="totalAmount" class="form-label">Total</label>
                                <input type="text" class="form-control" id="totalAmount">
                            </div>
                            <div class="mb-3">
                                <label for="dis" class="form-label">Discount</label>
                                <input type="text" class="form-control" id="dis">
                            </div>
                            <div class="mb-3">
                                <label for="amount" class="form-label">Amount</label>
                                <input type="text" class="form-control" id="amount">
                            </div>
                        </form>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-success" id="btnPurchaseOrder">Purchase</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>-->


<script src="../assets/js/bootstrap.js"></script>
<script src="../assets/js/jquery-3.6.1.min.js"></script>

<script>

    setCustomersName();
    setItemCode();

    function setCustomersName() {
        $.ajax({
            url: "http://localhost:8080/backEnd/pages/customer",
            success: function (resp) {
                for (let customer of resp.data) {
                    let row =`<option>${customer.id}</option>`;
                    $("#cmbCustomers").append(row);
                }
            }
        });
    }

   $('#cmbCustomers').change(function () {
       $.ajax({
           url:"http://localhost:8080/backEnd/pages/customer",
           success: function (resp) {
               for (let customer of resp.data) {
                   if($('#cmbCustomers').val()==customer.id){
                       $('#orderCustomerName').val(customer.name);
                       $('#orderCustomerAddress').val(customer.address);
                       $('#orderCustomerSalary').val(customer.salary);
                   }
               }
           }
       });
   });

    function setItemCode() {
        $.ajax({
            url: "http://localhost:8080/backEnd/pages/item",
            success: function (resp) {
                for (let item of resp.data) {
                    let row =`<option>${item.code}</option>`;
                    $("#cmbItems").append(row);
                }
            }
        });
    }

    $('#cmbItems').change(function () {
        $.ajax({
            url:"http://localhost:8080/backEnd/pages/item",
            success: function (resp) {
                for (let item of resp.data) {
                    if($('#cmbItems').val()==item.code){
                        $('#txtItemName').val(item.description);
                        $('#txtQTYOnHand').val(item.qty);
                        $('#txtItemPrice').val(item.unitPrice);
                    }
                }
            }
        });
    });

    $("#btnAddToTable").click(function (){
        let QtyOnHand = +$('#txtQTYOnHand').val();
        let qty = +$('#txtQty').val();
        if (QtyOnHand >= qty) {
            let total = qty * $('#txtItemPrice').val();
            $('#total').text(total);
            $('#subtotal').text(total);
        }
    });

    $('#txtCash,#txtDiscount').keyup(function (){
        calculateTotal();
    });

    function calculateTotal() {
        let qty = +$('#txtQty').val();
        let total = qty * $('#txtItemPrice').val();
        let discount = +$('#txtDiscount').val();
        let subTotal;
        if (discount >= 0) {
            subTotal = total - discount;
            $('#subtotal').text(subTotal);
        } else {
            subTotal = total;
            $('#subTotal').text(total);
        }
        let cash = +$('#txtCash').val();
        if (cash > 0) {
            $('#txtBalance').val(cash - subTotal);
        } else {
            $('#txtBalance').val(0);
        }
    }

    $("#btnSubmitOrder").click(function (){

        let id=$("#txtOrderID").val();
        let date=$("#txtDate").val();
        let cusId=$('#cmbCustomers').val();
        let itemCode=$('#cmbItems').val();
        let qty = $('#txtQty').val();
        let unitPrice=$('#txtItemPrice').val();

        let orderAll={
            "id":id,
            "date":date,
            "cusId":cusId,
            "itemCode":itemCode,
            "qty":qty,
            "unitPrice":unitPrice
        }
        $.ajax({
            url: 'http://localhost:8080/backEnd/pages/order',
            method: "post",
            contentType:"application/json",
            data:JSON.stringify(orderAll),

            success: function (res) {
                alert(res.message);

            },
            error: function (error) {
                alert(error.responseJSON.message);

            }
        });

    });



</script>

</body>
</html>
